<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cz武器</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mycss.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

</head>

<body id="product" class="">
    <nav class="navbar navbar-expand-lg bg-body-tertiary  ">
        <div class="container-fluid">
            <a class="navbar-brand " href="index.html">首頁</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                    <li class="nav-item">
                        <a class="nav-link  " aria-current="page" href="thief.html">盜賊</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link  " aria-current="page" href="hunter.html">獵人</a>

                    <li class="nav-item">
                        <a class="nav-link  " aria-current="page" href="warrior.html">戰士</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link  " aria-current="page" href="mage.html">法師</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link  text-primary" aria-current="page" href="CZ.html">CZ武器</a>
                    </li>
                </ul>
            </div>

            <span> <button type="button" class="btn btn-primary ms-3" data-bs-toggle="modal" data-bs-target="#addModal">
                    新增產品
                </button></span>
            <span><a class="btn btn-danger ms-3" id="logout" href="#">登出</a></span>
        </div>
    </nav>
    <div class="container">
        <div class="row justify-content-center mb-5">
            <div class="col-md-6">
                <select name="" id="type" class="form-control" v-model="currentType">
                    <option value="">請選擇</option>
                    <option value="惡魔之拳">惡魔之拳</option>
                    <option value="間諜神斬">間諜神斬</option>
                    <option value="聖魂之劍">聖魂之劍</option>
                    <option value="最終霸氣之矛">最終霸氣之矛</option>
                    <option value="烈焰斷魂斧">烈焰斷魂斧</option>
                    <option value="聖戰士之槌">聖戰士之槌</option>
                    <option value="靈魂擴張弓">靈魂擴張弓</option>
                    <option value="心靈擴張弩">靈魂擴張弩</option>
                </select>
            </div>
        </div>
        <div class="row text-center">
            <div class="col-md-12">
                <table class="table">
                    <thead>
                        <tr>
                            <th>名稱</th>
                            <th>副屬性</th>
                            <th>主屬性</th>
                            <th>攻擊</th>
                            <th>價格</th>
                        </tr>
                    </thead>
                    <tbody v-for="(item,key) in product">
                        <tr v-if="item.name ==currentType">
                            <td>{{item.name}}</td>
                            <td>{{item.side}}</td>
                            <td>{{item.main}}</td>
                            <td>{{item.AD}}</td>
                            <td>{{item.price}}</td>
                            <td><a href="#" data-bs-toggle="modal" data-bs-target="#updateModal" class="btn btn-primary"
                                    @click="edit_product(item.id,item.name,item.side,item.main,item.AD,item.price)">修改</a>
                            </td>
                            <td><a href="#" class="btn btn-danger" @click="del(item.id,item.name)">刪除</a></td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
        <!-- updateModal -->
        <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="updateModalLabel">商品修改</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" class="form-control" id="edit_id" v-model="edit_id">
                        <div class="mb-3">
                            <label for="" class="form-label">名稱</label>
                            <select name="" id="edit_name" class="form-control">
                                <option value="惡魔之拳">惡魔之拳</option>
                                <option value="間諜神斬">間諜神斬</option>
                                <option value="聖魂之劍">聖魂之劍</option>
                                <option value="最終霸氣之矛">最終霸氣之矛</option>
                                <option value="烈焰斷魂斧">烈焰斷魂斧</option>
                                <option value="聖戰士之槌">聖戰士之槌</option>
                                <option value="靈魂擴張弓">靈魂擴張弓</option>
                                <option value="心靈擴張弩">靈魂擴張弩</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">副屬性</label>
                            <input type="number" class="form-control" id="edit_side" v-model="edit_D">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">主屬性</label>
                            <input type="number" class="form-control" id="edit_main" v-model="edit_L">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">攻擊</label>
                            <input type="number" class="form-control" id="edit_AD" v-model="edit_AD">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">價格</label>
                            <input type="text" class="form-control" id="edit_price" v-model="edit_price">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="btn_modal_update"
                            @click="update_product()">確定修改</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增產品Modal -->
        <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="addModalLabel">商品新增</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="" class="form-label">名稱</label>
                            <select name="" id="add_name" class="form-control">
                                <option value="">請選擇</option>
                                <option value="惡魔之拳">惡魔之拳</option>
                                <option value="間諜神斬">間諜神斬</option>
                                <option value="聖魂之劍">聖魂之劍</option>
                                <option value="最終霸氣之矛">最終霸氣之矛</option>
                                <option value="烈焰斷魂斧">烈焰斷魂斧</option>
                                <option value="聖戰士之槌">聖戰士之槌</option>
                                <option value="靈魂擴張弓">靈魂擴張弓</option>
                                <option value="心靈擴張弩">靈魂擴張弩</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">副屬性</label>
                            <input type="number" class="form-control" id="add_side">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">主屬性</label>
                            <input type="number" class="form-control" id="add_main">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">攻擊</label>
                            <input type="number" class="form-control" id="add_AD">
                        </div>
                        <div class="mb-3">
                            <label for="" class="form-label">價格</label>
                            <input type="number" step="0.01" class="form-control" id="add_price">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="btn_modal_add"
                            @click="add_product()">確定新增</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.7.0.min.js"></script>
    <script src="https://unpkg.com/counterup2@2.0.2/dist/index.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        $(function () {
            setCookie("type", "");
        });

        const App = {
            data() {
                return {
                    product: [],
                    currentType: getCookie("type"),
                }
            },
            created() {
                const vm = this;
                //取得商品
                $.ajax({
                    url: 'https://ms0728707.000webhostapp.com/mystery/api/product_control_r_api.php',
                    type: "post",
                    data: {
                        table: 'cz'
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        if (data.state) {
                            data.data.forEach(function (item) {
                                vm.product.push(item);
                            });
                        } else {
                            alert(data.message);
                        }
                    },
                    error: function () {
                        alert("error-api/product_control_r_api.php");
                    }
                });
            },
            methods: {
                edit_product(id, name, side, main, AD, price) {
                    $("#edit_id").val(id);
                    $("#edit_name").val(name);
                    $("#edit_side").val(side);
                    $("#edit_main").val(main);
                    $("#edit_AD").val(AD);
                    $("#edit_price").val(price);
                },
                update_product() {

                    $.ajax({
                        url: 'https://ms0728707.000webhostapp.com/mystery/api/product_u_api.php',
                        type: "post",
                        dataType: 'json',
                        data: {
                            id: $("#edit_id").val(),
                            name: $("#edit_name").val(),
                            side: $("#edit_side").val(),
                            main: $("#edit_main").val(),
                            AD: $("#edit_AD").val(),
                            price: $("#edit_price").val(),
                            table: "cz"
                        },
                        success: function (data) {
                            console.log(data);
                            if (data.state) {
                                alert(data.message);
                                location.href = "CZ.html";
                                setCookie("type", $("#edit_name").val());
                            }
                        },
                        error: function () {
                            alert("error-api/product_u_api.php")
                        }
                    });

                },
                add_product() {
                    $.ajax({
                        url: 'https://ms0728707.000webhostapp.com/mystery/api/product_create_api.php',
                        type: "post",
                        dataType: 'json',
                        data: {
                            name: $("#add_name").val(),
                            side: $("#add_side").val(),
                            main: $("#add_main").val(),
                            AD: $("#add_AD").val(),
                            price: $("#add_price").val(),
                            table: "cz"
                        },
                        success: function (data) {
                            console.log(data);
                            if (data.state) {
                                alert(data.message);
                                location.href = "CZ.html";
                                setCookie("type", $("#add_name").val());
                            }
                        },
                        error: function () {
                            alert("error-api/product_create_api.php")
                        }
                    });
                },
                del(id, type) {
                    if (confirm("確定刪除" + type + "?")) {
                        $.ajax({
                            url: 'https://ms0728707.000webhostapp.com/mystery/api/product_d_api.php',
                            type: "post",
                            dataType: 'json',
                            data: {
                                id: id,
                                table: "cz"
                            },
                            success: function (data) {
                                if (data.state) {
                                    alert(data.message);
                                    location.href = "CZ.html";
                                    setCookie("type", type);
                                }
                            },
                            error: function () {
                                alert("error-api/product_create_api.php")
                            }
                        });
                    }

                }
            },
        }
        Vue.createApp(App).mount("#product");
        $("#product").removeClass("d-none");

        //import w3
        function setCookie(cname, cvalue, exdays) {
            const d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            let expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }
        function getCookie(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }



    </script>
</body>

</html>